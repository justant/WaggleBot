# WaggleBot Next — 아키텍처 개선 명세

> 목표: **시청자가 좋아할 영상**을 **운영자가 효율적으로** 대량 생산하는 시스템

---

## 목차

1. [현행 시스템 진단](#1-현행-시스템-진단)
2. [콘텐츠 품질 혁신 (시청자 관점)](#2-콘텐츠-품질-혁신-시청자-관점)
3. [대시보드 혁신 (운영자 관점)](#3-대시보드-혁신-운영자-관점)
4. [파이프라인 최적화](#4-파이프라인-최적화)
5. [데이터 기반 성장 루프](#5-데이터-기반-성장-루프)
6. [구현 우선순위 로드맵](#6-구현-우선순위-로드맵)

---

## 1. 현행 시스템 진단

### 1.1 현재 파이프라인 (As-Is)

```
크롤링 → 전부 COLLECTED → 수동 1건씩 승인 → LLM 요약(200자) → Edge-TTS → FFmpeg(Ken Burns) → YouTube 업로드
```

### 1.2 핵심 병목

| 영역 | 문제 | 영향 |
|------|------|------|
| **콘텐츠 선별** | 인기도 점수 없음, 운영자가 전수 검토 | 시간 낭비, 저품질 게시글 혼입 |
| **대본 품질** | 200자 단순 요약, 스토리 구조 없음 | 시청 지속 시간 짧음, 이탈률 높음 |
| **영상 품질** | 정적 자막, 전환 효과 없음, 단일 Ken Burns | 시각적 단조로움, 채널 차별화 불가 |
| **썸네일** | 자동 생성 없음 | CTR(클릭률) 저하 |
| **운영 효율** | 1건씩 승인, 대본 수정 불가, 배치 작업 없음 | 일 처리량 한계 (17~40건/일) |
| **피드백 루프** | 업로드 후 성과 추적 없음 | 개선 방향 파악 불가 |

### 1.3 목표 파이프라인 (To-Be)

```
크롤링 → 자동 스코어링 → 상위 N건 추천 → 운영자 배치 승인
    → 후킹 대본 생성 → 대본 미리보기/수정 → TTS
    → 동적 자막 + 전환 효과 + 썸네일 → 영상 미리보기
    → 멀티 플랫폼 업로드 → 성과 추적 → 다음 크롤링에 반영
```

---

## 2. 콘텐츠 품질 혁신 (시청자 관점)

### 2.1 자동 인기도 스코어링

**문제:** 크롤링된 모든 게시글이 동일하게 COLLECTED → 운영자가 전수 검토.

**해결:** 수집 시점에 engagement score를 계산하여 우선순위 부여.

```python
# 스코어링 공식 (가중 합산)
def calculate_engagement_score(stats: dict, comments: list, age_hours: float) -> float:
    """
    시간 감쇠(time-decay) 적용 인기도 점수.
    최신 + 반응 좋은 게시글이 높은 점수.
    """
    views = stats.get("views", 0)
    likes = stats.get("likes", 0)
    comment_count = stats.get("comments_count", 0)

    # 베스트 댓글 반응도 (공감 많은 댓글 = 논쟁적/흥미로운 주제)
    top_comment_likes = sum(c.get("likes", 0) for c in comments[:5])

    raw_score = (
        views * 0.1
        + likes * 2.0
        + comment_count * 1.5
        + top_comment_likes * 0.5
    )

    # 시간 감쇠: 6시간 반감기
    decay = 0.5 ** (age_hours / 6.0)

    return round(raw_score * decay, 1)
```

**적용 위치:**
- `crawlers/base.py` → `_upsert()` 에서 score 계산 후 `Post.engagement_score`에 저장
- `db/models.py` → `Post` 모델에 `engagement_score = Column(Float, default=0.0)` 추가
- `dashboard.py` → 수신함에서 score 순 정렬, 상위 N건 하이라이트

**운영자 경험 변화:**
- Before: 50건 전부 읽고 판단
- After: 상위 10건만 빠르게 승인 (score 기반 추천)

---

### 2.2 쇼츠 특화 대본 구조

**문제:** 현재 LLM 프롬프트는 200자 단순 요약 → 시청자 후킹/몰입 구조 없음.

**해결:** 쇼츠 영상의 시청 패턴에 최적화된 3막 구조 대본 생성.

```
[1막: 후킹 — 0~3초]  "이거 실화냐?" / "댓글 반응 미쳤다" / 충격적 질문
[2막: 본문 — 3~45초] 게시글 핵심 + 베스트 댓글 반응
[3막: 클로저 — 45~60초] 공감 유도 + 구독/좋아요 CTA
```

**LLM 프롬프트 개선:**

```python
SCRIPT_PROMPT_V2 = """
당신은 유튜브 쇼츠 대본 작가입니다.

## 입력
- 제목: {title}
- 본문: {content}
- 베스트 댓글: {top_comments}

## 출력 형식 (JSON)
{{
  "hook": "시청자가 스크롤을 멈출 한 줄 (15자 이내, 의문형/감탄형)",
  "body": [
    "핵심 내용 문장 1",
    "핵심 내용 문장 2",
    "핵심 내용 문장 3",
    "베스트 댓글 인용: 'OOO'"
  ],
  "closer": "공감 유도 마무리 문장 + 구독 CTA",
  "title_suggestion": "YouTube 쇼츠 제목 (50자 이내, 이모지 포함)",
  "tags": ["태그1", "태그2", "태그3"]
}}

## 규칙
- 총 분량: TTS로 읽었을 때 40~55초
- 말투: 반말, ~했다/~인데/~ㅋㅋ 구어체
- 베스트 댓글 최소 1개 인용 (따옴표 표시)
- 자극적이되 사실 왜곡 금지
"""
```

**구조화된 대본의 장점:**
- `hook` → 첫 3초 이탈 방지 (쇼츠 알고리즘 핵심 지표)
- `body` 배열 → 문장 단위 자막 타이밍 제어 가능
- `title_suggestion` → 썸네일/제목 자동 생성
- `tags` → 업로드 시 태그 자동 적용
- JSON 출력 → 파싱 안정성, 후처리 용이

**적용 위치:**
- `ai_worker/llm.py` → 프롬프트 교체, JSON 파싱 로직 추가
- `db/models.py` → `Content.summary_text`를 JSON 구조로 저장 (호환성 유지: 문자열이면 레거시)

---

### 2.3 동적 자막 시스템

**문제:** 현재 `drawtext` 필터로 전체 문장을 한 번에 표시 → 단조롭고 가독성 낮음.

**해결:** 문장 단위 페이드인 + 핵심 키워드 강조 자막.

**구현 방식 (FFmpeg ASS 자막):**

```
# 현재: drawtext 필터 1개로 전체 자막
drawtext=text='긴 문장 전체':fontsize=45:...

# 개선: ASS 자막 파일 생성 → subtitles 필터
subtitles=subtitle.ass:force_style='...'
```

**ASS 자막의 장점:**
- 문장별 등장/퇴장 시간 제어 (fade-in/out)
- 폰트 크기/색상을 문장 내 부분별로 변경 가능
- 키워드 강조 (`{\c&H00FFFF&}핵심단어{\c&HFFFFFF&}`)
- 위치 애니메이션 (아래→위 슬라이드)

**자막 스타일 프리셋:**

| 프리셋 | 용도 | 효과 |
|--------|------|------|
| `dramatic` | 충격/논란 게시글 | 빨간 강조, 흔들림 효과 |
| `casual` | 일상/웃긴 게시글 | 둥근 폰트, 노란 강조 |
| `news` | 정보/이슈 게시글 | 뉴스 자막 스타일, 하단 띠 |
| `comment` | 댓글 인용 | 말풍선 배경, 이탤릭 |

**적용 위치:**
- `ai_worker/video.py` → ASS 자막 생성 함수 추가, `render_video()`에서 `subtitles` 필터 사용
- 새 파일: `ai_worker/subtitle.py` (자막 생성 전담 모듈)

---

### 2.4 장면 전환 효과

**문제:** 이미지 간 전환이 하드컷 → 시각적으로 단조롭고 아마추어 느낌.

**해결:** FFmpeg xfade 필터를 활용한 부드러운 전환.

```python
# FFmpeg xfade 필터 — 이미지 간 크로스페이드
TRANSITIONS = [
    "fade",           # 기본 페이드
    "fadeblack",      # 블랙 경유 페이드
    "slideleft",      # 왼쪽 슬라이드
    "slideup",        # 위로 슬라이드
    "circleopen",     # 원형 열림
    "dissolve",       # 디졸브
]

# 사용 예시
f"[0:v][1:v]xfade=transition={transition}:duration=0.5:offset={offset}[v]"
```

**전환 전략:**
- hook 문장: `circleopen` (주의 집중)
- body 문장 사이: `fade` 또는 `dissolve` (자연스러운 흐름)
- 댓글 인용: `slideleft` (화면 전환 느낌)
- closer: `fadeblack` (마무리 느낌)

**적용 위치:**
- `ai_worker/video.py` → 이미지 슬라이드쇼 생성 로직 (`_build_slideshow`) 내 xfade 적용

---

### 2.5 자동 썸네일 생성

**문제:** 썸네일 없이 업로드 → YouTube/TikTok 알고리즘에서 CTR 불리.

**해결:** 영상의 핵심 프레임 + 텍스트 오버레이로 썸네일 자동 생성.

```python
def generate_thumbnail(
    hook_text: str,
    images: list[Path],
    output_path: Path,
    style: str = "dramatic"
) -> Path:
    """
    1280x720 썸네일 생성.
    - 배경: 첫 번째 이미지 또는 영상 프레임 (블러 처리)
    - 텍스트: hook 문장 (큰 폰트, 외곽선)
    - 이모지/스티커: 스타일에 따라 자동 배치
    """
```

**썸네일 스타일:**

| 스타일 | 배경 | 텍스트 | 보조 요소 |
|--------|------|--------|-----------|
| `dramatic` | 이미지 + 빨간 그라데이션 | 흰색 외곽, 45° 기울기 | ⚠️ 아이콘 |
| `question` | 이미지 + 파란 그라데이션 | 노란색, 물음표 강조 | ❓ 아이콘 |
| `funny` | 이미지 + 밝은 톤 | 검정 외곽, 밝은 색 | 😂 이모지 |
| `news` | 그라데이션 단색 | 뉴스 자막 스타일 | 날짜 표시 |

**적용 위치:**
- 새 파일: `ai_worker/thumbnail.py`
- `ai_worker/processor.py` → 렌더링 단계 후 썸네일 생성 추가
- `uploaders/youtube.py` → `thumbnail_path` 메타데이터 전달

---

### 2.6 BGM 지능형 믹싱

**문제:** 현재 BGM 볼륨 0.15 고정 → 말하는 동안에도 동일, 감정 변화 없음.

**해결:**

**A. 구간별 볼륨 다이내믹스:**
```
hook 구간: BGM 볼륨 0.05 (거의 무음 — 후킹 문장에 집중)
body 구간: BGM 볼륨 0.12 (배경 분위기)
closer 구간: BGM 볼륨 0.20 (엔딩 분위기 고조)
문장 사이 무음: BGM 볼륨 0.25 (자연스러운 전환)
```

**B. 분위기 기반 BGM 선택:**
- LLM이 대본 생성 시 `mood` 태그 함께 출력: `funny`, `serious`, `shocking`, `heartwarming`
- `assets/bgm/` 하위를 `funny/`, `serious/` 등으로 분류
- 매칭 BGM 자동 선택

**적용 위치:**
- `ai_worker/video.py` → 구간별 볼륨 제어 FFmpeg 필터 적용
- `ai_worker/llm.py` → 프롬프트에 `mood` 필드 추가
- `assets/bgm/` → 분위기별 하위 디렉토리 구조화

---

### 2.7 댓글 활용 극대화

**문제:** 베스트 댓글을 텍스트로만 읽어줌 → 시각적 차별화 없음.

**해결:**

```
본문 구간:  일반 자막 스타일 (하단 중앙, 흰색)
댓글 인용:  말풍선 UI (상단, 노란 배경, 프로필 아이콘)
            + 효과음 ("띠링" 알림 사운드)
            + 0.3초 화면 흔들림 (shake 효과)
```

**FFmpeg 구현:**
- 댓글 구간에 별도 `drawbox` + `drawtext` 레이어로 말풍선 표현
- `geq` 필터로 미세 흔들림 효과 (1~2px 랜덤 오프셋)

---

## 3. 대시보드 혁신 (운영자 관점)

### 3.1 스마트 수신함 (Tab 1 개선)

**현재 문제:**
- 게시글이 시간순 나열 → 좋은 콘텐츠를 찾으려면 전부 읽어야 함
- 1건씩만 승인/거절 → 대량 처리 불가
- 콘텐츠 적합성 판단 근거 부족

**개선안:**

**A. 스코어 기반 추천 뷰:**
```
┌──────────────────────────────────────────────────┐
│ 📥 수신함                     [새로고침] [설정]     │
├──────────────────────────────────────────────────┤
│ 🏆 추천 (Score 80+)          3건                  │
│ ┌─────────────────────────────────────────────┐  │
│ │ ☑ [92.3] 네이트판 | "시어머니가 결혼식에..."    │  │
│ │     👁 12,340  👍 892  💬 234  🖼 3장         │  │
│ │     📊 예상 조회수: 5,000~12,000              │  │
│ ├─────────────────────────────────────────────┤  │
│ │ ☑ [87.1] 네이트판 | "회사에서 점심시간에..."    │  │
│ │     👁 8,920  👍 567  💬 189                  │  │
│ │     📊 예상 조회수: 3,000~8,000               │  │
│ └─────────────────────────────────────────────┘  │
│                                                    │
│ [✅ 선택 항목 일괄 승인 (2건)]  [❌ 일괄 거절]      │
│                                                    │
│ 📋 일반 (Score 30~79)         12건                 │
│ 📉 낮음 (Score 0~29)          35건  [전체 거절 ▶]  │
└──────────────────────────────────────────────────┘
```

**B. 배치 작업:**
- 체크박스로 다중 선택 → 일괄 승인/거절
- 스코어 구간별 일괄 처리 (예: "30점 이하 전체 거절")
- 키보드 단축키: `A` 승인, `D` 거절, `Space` 다음 게시글

**C. AI 적합성 분석:**
- LLM으로 "쇼츠 영상 적합도" 사전 평가 (1~10점)
- 판단 근거 요약: "논쟁적 주제 + 공감대 높은 댓글 → 적합"
- 부적합 사유 표시: "광고성 게시글", "저작권 이미지", "민감 주제"

**D. 자동 승인 모드:**
- 스코어 N점 이상 자동 APPROVED (운영자가 임계값 설정)
- 자동 승인된 건은 별도 표시 (수동 검토 가능)

---

### 3.2 대본 편집기 (Tab 2 개선 → 새로운 "편집" 탭)

**현재 문제:**
- LLM 대본 생성 후 수정 불가 → 부적절한 표현도 그대로 TTS 변환
- 대본 미리보기 없음 → 결과물을 영상 생성 후에야 확인 가능

**개선안:**

```
┌──────────────────────────────────────────────────┐
│ ✏️ 대본 편집                                      │
├──────────────────────────────────────────────────┤
│ 원본 게시글                    AI 대본              │
│ ┌──────────────────┐  ┌──────────────────────┐  │
│ │ [원문 제목]        │  │ 🎣 후킹              │  │
│ │                    │  │ "이거 실화야?"        │  │
│ │ [원문 본문...]     │  │                      │  │
│ │                    │  │ 📝 본문              │  │
│ │ [베스트 댓글...]   │  │ "시어머니가..."       │  │
│ │                    │  │ "댓글: 'ㅋㅋㅋ...'"  │  │
│ │                    │  │                      │  │
│ │                    │  │ 🔚 마무리            │  │
│ │                    │  │ "여러분 생각은?"      │  │
│ └──────────────────┘  └──────────────────────┘  │
│                                                    │
│ 예상 길이: 47초  |  [🔄 대본 재생성]  [▶ TTS 미리듣기]│
│                                                    │
│ 🎬 영상 제목: "시어머니 결혼식 폭탄 발언..."        │
│ 🏷️ 태그: #시어머니 #결혼식 #커뮤니티               │
│ 🎭 분위기: shocking → BGM: tense_01.mp3            │
│                                                    │
│ [💾 저장 & TTS 생성]  [⏭ 건너뛰기]                 │
└──────────────────────────────────────────────────┘
```

**핵심 기능:**
- 좌우 분할: 원본 게시글 | AI 대본 (편집 가능)
- 대본 각 섹션(hook/body/closer) 개별 수정
- **TTS 미리듣기**: 대본 수정 → TTS 즉시 생성 → 오디오 재생 (영상 렌더링 없이)
- **예상 길이**: 글자 수 기반 TTS 예상 시간 표시
- **대본 재생성**: 프롬프트 파라미터 조정 후 LLM 재호출
- 영상 제목/태그 수정 가능

---

### 3.3 영상 미리보기 (Tab 3 갤러리 개선)

**현재 문제:**
- 렌더링 완료 후에만 결과 확인 → 마음에 안 들면 처음부터 재작업
- 삭제만 가능, 부분 수정 불가

**개선안:**

**A. 렌더링 전 미리보기:**
```
┌──────────────────────────────────────────────────┐
│ 🎬 미리보기 (렌더링 전)                            │
│ ┌──────────────────────────────────────────────┐ │
│ │                                              │ │
│ │    [슬라이드쇼 + 자막 프리뷰]                  │ │
│ │    (저해상도 빠른 렌더)                        │ │
│ │                                              │ │
│ └──────────────────────────────────────────────┘ │
│                                                    │
│ 자막 스타일: [dramatic ▼]   전환 효과: [auto ▼]    │
│ BGM: [tense_01.mp3 ▼]      BGM 볼륨: [====●==] 0.15│
│                                                    │
│ [🔄 프리뷰 새로고침]  [✅ 고화질 렌더링 시작]        │
└──────────────────────────────────────────────────┘
```

- 저해상도(480x854) 빠른 프리뷰 생성 (10~15초)
- 프리뷰에서 자막 스타일/BGM/전환 효과 조정
- 만족 후 고화질(1080x1920) 최종 렌더링

**B. 갤러리 개선:**
- 영상 비교 뷰 (이전 버전 vs 현재 버전)
- 업로드 전 최종 체크리스트 (제목/태그/썸네일/프라이버시)
- 업로드 스케줄링 (즉시/예약 시간 지정)

---

### 3.4 운영 대시보드 (새로운 "분석" 탭)

```
┌──────────────────────────────────────────────────┐
│ 📊 분석                                           │
├──────────────────────────────────────────────────┤
│                                                    │
│ 📈 주간 생산성                                     │
│ ┌──────────────────────────────────────────────┐ │
│ │ 수집: 350건 → 승인: 42건 → 렌더링: 40건       │ │
│ │ → 업로드: 38건  | 전환율: 10.9%               │ │
│ │ 평균 처리 시간: 2분 34초/건                    │ │
│ └──────────────────────────────────────────────┘ │
│                                                    │
│ 🏆 Top 5 영상 (조회수)                             │
│ 1. "시어머니 결혼식..." — 12,340회 👍 892         │
│ 2. "회사 점심시간..."   — 8,920회  👍 567         │
│                                                    │
│ 📉 성과 분석                                       │
│ ┌──────────────────────────────────────────────┐ │
│ │ 평균 조회수: 3,200회                           │ │
│ │ 평균 시청 유지율: 45%                          │ │
│ │ 구독 전환: 2.1%                               │ │
│ │ 최적 업로드 시간: 오후 6~9시                    │ │
│ └──────────────────────────────────────────────┘ │
│                                                    │
│ 🎯 인사이트                                        │
│ - "논쟁형" 주제가 평균 조회수 2.3배 높음           │
│ - 후킹 의문문 사용 시 시청 유지율 +12%             │
│ - 60초 이하 영상이 완주율 31% 높음                 │
└──────────────────────────────────────────────────┘
```

**데이터 수집:**
- YouTube Analytics API: 조회수, 시청 지속시간, 좋아요, 구독 전환
- 수집 주기: 업로드 후 1일, 3일, 7일, 30일
- `Content.upload_meta`에 analytics 결과 누적 저장 (스키마 변경 불필요)

**인사이트 자동 생성:**
- 주간 단위로 LLM이 성과 데이터 분석 → 인사이트 텍스트 생성
- "이런 주제가 잘 됐다" → 크롤링 키워드/스코어링 가중치에 반영

---

### 3.5 탭 구조 재설계

```
현재: 수신함 | 진행현황 | 갤러리 | 설정

개선: 수신함 | 편집실 | 갤러리 | 분석 | 설정
      (스마트   (대본편집  (미리보기  (성과     (파이프라인
       승인)     +TTS)    +업로드)   추적)     +인증)
```

| 탭 | 주요 변화 |
|-----|-----------|
| **수신함** | 스코어 기반 추천, 배치 승인, 자동 승인 모드 |
| **편집실** (신규) | 대본 미리보기/수정, TTS 미리듣기, 제목/태그 편집 |
| **갤러리** | 저해상도 프리뷰, 업로드 스케줄링, 썸네일 편집 |
| **분석** (신규) | YouTube 성과, 생산성 지표, AI 인사이트 |
| **설정** | 기존 유지 + 자동 승인 임계값, 자막 스타일 프리셋 |

---

## 4. 파이프라인 최적화

### 4.1 병렬 처리 도입

**현재:** 1건씩 순차 (LLM → TTS → 렌더링 → 다음 건)

**개선:** 단계별 파이프라이닝

```
시간 →
Post A:  [LLM] [TTS] [Render]
Post B:        [LLM] [TTS   ] [Render]
Post C:              [LLM   ] [TTS   ] [Render]
```

**핵심:** LLM과 TTS는 GPU 순차지만, 이전 건의 렌더링과 다음 건의 LLM은 동시 가능 (렌더링은 NVENC 전용 하드웨어, LLM은 CUDA 코어 사용).

**구현:**
- `ai_worker/processor.py` → `asyncio` 기반 파이프라인 큐
- GPU 매니저가 NVENC/CUDA 자원을 분리 추적
- 예상 처리량: 1.5~2배 향상 (30~60건/일)

### 4.2 프리뷰 렌더링 분리

```
고화질 렌더링: 1080x1920, h264_nvenc, 60~180초
프리뷰 렌더링: 480x854, libx264(CPU), 10~15초
```

- 프리뷰는 CPU로 처리 → GPU 점유 없음
- 운영자가 프리뷰 확인 후 고화질 렌더링 트리거
- 불필요한 고화질 렌더링 방지 → GPU 시간 절약

### 4.3 캐싱 전략

| 대상 | 캐싱 방법 | 효과 |
|------|-----------|------|
| LLM 대본 | `Content.summary_text`에 저장 후 재사용 | 대본 수정 시 LLM 재호출 불필요 |
| TTS 오디오 | 대본 해시 기반 캐싱 | 동일 대본이면 TTS 생략 |
| 이미지 리사이즈 | `media/tmp/img_cache/` | 재렌더링 시 이미지 처리 생략 |
| BGM 정보 | 파이프라인 설정에 매핑 저장 | 재렌더링 시 동일 BGM 유지 |

---

## 5. 데이터 기반 성장 루프

### 5.1 피드백 루프 설계

```
                    ┌─────────────────┐
                    │  YouTube 성과    │
                    │  (조회수/유지율)  │
                    └────────┬────────┘
                             │ 수집
                    ┌────────▼────────┐
                    │  성과 분석 DB    │
                    │  (upload_meta)   │
                    └────────┬────────┘
                             │ 분석
                    ┌────────▼────────┐
                    │  LLM 인사이트    │
                    │  "논쟁형 +2.3배" │
                    └────────┬────────┘
                             │ 반영
              ┌──────────────┼──────────────┐
              ▼              ▼              ▼
     스코어링 가중치    대본 프롬프트    자막 스타일
     조정              튜닝           최적화
```

### 5.2 A/B 테스트 프레임워크

**목적:** 어떤 대본 스타일, 자막, 썸네일이 더 효과적인지 데이터로 검증.

```python
# Content 모델에 variant 필드 추가 (스키마 변경 필요 — 승인 필수)
class Content(Base):
    # ... 기존 필드
    variant_group = Column(String(64), nullable=True)   # A/B 테스트 그룹 ID
    variant_label = Column(String(32), nullable=True)    # "A" 또는 "B"
    variant_config = Column(JSON, nullable=True)         # 해당 variant의 설정값
```

**운영 시나리오:**
1. 동일 게시글로 2개 영상 생성 (A: 의문형 후킹, B: 감탄형 후킹)
2. 동시 업로드 후 7일 뒤 성과 비교
3. 승자 스타일을 기본 프롬프트에 반영

**주의:** `db/models.py` 스키마 변경 → 마이그레이션 필요 → 별도 승인 프로세스.

---

## 6. 구현 우선순위 로드맵

### Phase 3A — 즉시 효과 (1~2주)

영상 품질과 운영 효율에 즉시 영향을 주는 변경. 스키마 변경 없이 구현 가능.

| # | 항목 | 파일 | 효과 |
|---|------|------|------|
| 1 | **쇼츠 대본 구조화** (2.2) | `ai_worker/llm.py` | 시청 유지율 대폭 개선 |
| 2 | **인기도 스코어링** (2.1) | `crawlers/base.py`, `dashboard.py` | 운영 시간 70% 절감 |
| 3 | **배치 승인/거절** (3.1B) | `dashboard.py` | 대량 처리 가능 |
| 4 | **대본 미리보기/수정** (3.2) | `dashboard.py` | 부적절 표현 사전 차단 |
| 5 | **자동 썸네일 생성** (2.5) | 신규 `ai_worker/thumbnail.py` | CTR 향상 |

> 스코어링은 `Post.stats` JSON 내부 값 활용 → `engagement_score` 컬럼 없이도 대시보드에서 실시간 계산 가능.

### Phase 3B — 품질 도약 (2~4주)

영상의 시각적 품질을 한 단계 끌어올리는 변경.

| # | 항목 | 파일 | 효과 |
|---|------|------|------|
| 6 | **ASS 동적 자막** (2.3) | 신규 `ai_worker/subtitle.py`, `video.py` | 시각적 몰입도 |
| 7 | **장면 전환 효과** (2.4) | `ai_worker/video.py` | 프로급 영상 품질 |
| 8 | **BGM 지능형 믹싱** (2.6) | `ai_worker/video.py`, `llm.py` | 감정 몰입 |
| 9 | **댓글 시각 효과** (2.7) | `ai_worker/video.py`, `subtitle.py` | 참여 유도 |
| 10 | **프리뷰 렌더링** (4.2) | `ai_worker/video.py`, `dashboard.py` | 재작업 감소 |

### Phase 3C — 성장 엔진 (4~8주)

데이터 기반 자동 최적화 시스템.

| # | 항목 | 파일 | 효과 |
|---|------|------|------|
| 11 | **YouTube 성과 수집** (3.4) | 신규 `analytics/collector.py` | 데이터 확보 |
| 12 | **분석 대시보드** (3.4) | `dashboard.py` 탭 추가 | 의사결정 근거 |
| 13 | **자동 승인 모드** (3.1D) | `dashboard.py`, `ai_worker/main.py` | 완전 자동화 |
| 14 | **파이프라인 병렬화** (4.1) | `ai_worker/processor.py` | 처리량 2배 |
| 15 | **A/B 테스트** (5.2) | `db/models.py`(승인 필요), 전체 | 지속 개선 루프 |

---

## 부록: 변경 영향도 매트릭스

| 파일 | Phase 3A | Phase 3B | Phase 3C | 비고 |
|------|:--------:|:--------:|:--------:|------|
| `ai_worker/llm.py` | ✏️ | ✏️ | | 프롬프트 개선 |
| `ai_worker/video.py` | | ✏️ | | xfade, ASS, BGM |
| `ai_worker/processor.py` | | | ✏️ | 병렬화 |
| `ai_worker/subtitle.py` | | 🆕 | | ASS 자막 생성 |
| `ai_worker/thumbnail.py` | 🆕 | | | 썸네일 생성 |
| `analytics/collector.py` | | | 🆕 | YouTube 데이터 수집 |
| `crawlers/base.py` | ✏️ | | | 스코어링 |
| `dashboard.py` | ✏️ | ✏️ | ✏️ | 전 Phase 걸쳐 개선 |
| `config/settings.py` | ✏️ | ✏️ | ✏️ | 새 설정값 추가 |
| `db/models.py` | ⚠️ 가능하면 보류 | | ⚠️ A/B 테스트 시 필요 | 승인 필수 |
| `uploaders/youtube.py` | ✏️ | | ✏️ | 썸네일 전달, Analytics API |

✏️ = 수정, 🆕 = 신규 생성, ⚠️ = 승인 필요
