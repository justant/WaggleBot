# /proposal — Write-Proposal 패키지 자동 생성

공유 파일(db/, config/settings.py 등) 변경이 필요할 때, `arch/env/AGENT_TEAM.md` Section 5의 Write-Proposal 패턴을 따라 올바른 Proposal 패키지를 생성하는 스킬.

## 사용법

```
/proposal
```

대화에서 변경 내용을 설명하면 이 스킬이 자동으로 패키지를 완성한다.

---

## 수행 절차

### Step 1 — 다음 Proposal 번호 결정

`_proposals/` 디렉토리 내 기존 폴더를 확인하여 다음 3자리 번호를 결정한다.
`_proposals/`가 없으면 `001`부터 시작.

### Step 2 — Proposal 패키지 디렉토리 생성

```
_proposals/{NNN}_{short_name}/
├── PROPOSAL.md
├── {filename}.patch          # 변경 파일의 변경 내용만 담은 초안
└── {NNN+3}_{desc}.sql        # DB 변경인 경우에만 생성
```

`short_name`은 변경 내용을 나타내는 snake_case 2~4 단어 (예: `add_post_priority`).

### Step 3 — PROPOSAL.md 작성

아래 템플릿을 그대로 사용한다. 비워야 할 항목은 `{placeholder}` 대신 실제 내용으로 채운다.

```markdown
# Proposal: {변경 요약 한 줄}

## 요청자
{요청 Agent 이름} — 예: Agent C (Crawler)

## 변경 파일
- `{파일 경로}`: {변경 내용 한 줄}

## 이유
{왜 이 변경이 필요한지 2~3 문장}

## 영향 범위
- {영향받는 Agent/파일}: {어떤 후속 작업이 필요한지}
- 없으면 "없음"

## 마이그레이션 (DB 변경 시)
```sql
ALTER TABLE {table} ADD COLUMN {column} {type} NOT NULL DEFAULT {default};
```
DB 변경이 아니면 이 섹션 삭제.

## 적용 명령 (CEO 실행)
```bash
# 파일 복사
cp _proposals/{NNN}_{short_name}/{filename}.patch {target_path}
# DB 마이그레이션 (해당 시)
python -m db.migrations.runner
```
```

### Step 4 — `.patch` 파일 작성

변경 대상 파일의 변경 부분만 담은 초안을 생성한다.
전체 파일이 아닌 **diff 형태 또는 변경될 코드 블록**만 포함.

DB 변경이면 마이그레이션 SQL 파일도 생성:
```sql
-- {NNN+3}_{desc}.sql
-- Generated by /proposal skill
ALTER TABLE {table} ADD COLUMN {column} {type} NOT NULL DEFAULT {default};
```

### Step 5 — CEO 승인 요청 메시지 출력

패키지 생성 후 아래 형식으로 출력:

```
🔔 공유 파일 변경 승인 요청
──────────────────────────
Proposal: _proposals/{NNN}_{short_name}/
변경 대상: {파일 목록}
요약: {한 줄 요약}
영향: {영향받는 Agent 목록, 없으면 "없음"}

승인하시겠습니까? (Y/n)
```

---

## 주의사항

- `.env`, `docker-compose*.yml`은 Proposal 대상이 아님. 해당 파일은 PROPOSAL.md의 주석 섹션에 "`.env`에 `X_KEY` 추가 필요" 메모만 남길 것.
- `_proposals/`는 `.gitignore`에 등록되어 있음. 별도 커밋 불필요.
- 승인 전까지 본 파일(db/models.py 등)은 절대 수정하지 않는다.
